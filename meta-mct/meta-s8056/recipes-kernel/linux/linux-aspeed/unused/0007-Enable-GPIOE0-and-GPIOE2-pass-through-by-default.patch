From c04d03aa5823dbc569fcab64f46d2184be4a0fd5 Mon Sep 17 00:00:00 2001
From: Janny Au <janny.au@mic.com.tw>
Date: Thu, 10 Mar 2022 15:51:58 +0800
Subject: [PATCH] Enable-GPIOE0-and-GPIOE2-pass-through-by-default

---
 drivers/gpio/gpio-aspeed.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/gpio/gpio-aspeed.c b/drivers/gpio/gpio-aspeed.c
index 318a7d95a1a8..9b05c715faec 100644
--- a/drivers/gpio/gpio-aspeed.c
+++ b/drivers/gpio/gpio-aspeed.c
@@ -1137,6 +1137,7 @@ static int __init aspeed_gpio_probe(struct platform_device *pdev)
 {
 	const struct of_device_id *gpio_id;
 	struct aspeed_gpio *gpio;
+	struct pinctrl *pinctrl;
 	int rc, i, banks, err;
 	u32 ngpio;
 
@@ -1187,6 +1188,15 @@ static int __init aspeed_gpio_probe(struct platform_device *pdev)
 		return -ENOMEM;
 
 	/*
+	 * Select the pass-through pinctrl config to enable the pass-through
+	 * mux for GPIOs E0 and E2. Then call pinctrl_put() to release claim
+	 * of the GPIO pins, so they can be requested at runtime.
+	 */
+	pinctrl = pinctrl_get_select(&pdev->dev, "pass-through");
+	if (pinctrl)
+		pinctrl_put(pinctrl);
+
+	/*	
 	 * Populate it with initial values read from the HW and switch
 	 * all command sources to the ARM by default
 	 */
