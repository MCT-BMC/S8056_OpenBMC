From 9c9527ef51ccb17c643d6e3d298a05b3eb7950a9 Mon Sep 17 00:00:00 2001
From: Osmond Chen <osmond.chen@mic.com.tw>
Date: Thu, 24 Mar 2022 13:48:17 +0800
Subject: [PATCH] Add sol-pattern matching sensor supported

---
 meson_options.txt         |  1 +
 service_files/meson.build |  1 +
 src/meson.build           | 20 ++++++++++++++++++++
 3 files changed, 22 insertions(+)

diff --git a/meson_options.txt b/meson_options.txt
index a7d627a..4339d09 100755
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -15,6 +15,7 @@ option('mos-temp', type: 'feature', value: 'enabled', description: 'Enable MOS t
 option('fan-presence', type: 'feature', value: 'enabled', description: 'Enable FAN presence sensor.',)
 option('dimm-temp', type: 'feature', value: 'enabled', description: 'Enable DIMM temperature sensor.',)
 option('nic', type: 'feature', value: 'enabled', description: 'Enable NIC over MCTP sensor.',)
+option('sol-pattern', type: 'feature', value: 'enabled', description: 'Enable SOL pattern sensor.',)
 option('tests', type: 'feature', value: 'enabled', description: 'Build tests.',)
 option('validate-unsecure-feature', type : 'feature', value : 'disabled', description : 'Enables unsecure features required by validation. Note: mustbe turned off for production images.',)
 option('insecure-sensor-override', type : 'feature', value : 'disabled', description : 'Enables Sensor override feature without any check.',)
diff --git a/service_files/meson.build b/service_files/meson.build
index 3927b49..dcce3da 100755
--- a/service_files/meson.build
+++ b/service_files/meson.build
@@ -15,6 +15,7 @@ unit_files = [
     ['fan-presence', 'xyz.openbmc_project.fanpresencesensor.service'],
     ['dimm-temp', 'xyz.openbmc_project.dimmtempsensor.service'],
     ['nic', 'xyz.openbmc_project.nicsensor.service'],
+    ['sol-pattern', 'xyz.openbmc_project.solpatternsensor.service'],
 ]
 
 foreach tuple : unit_files
diff --git a/src/meson.build b/src/meson.build
index 7ea6c01..48f9c79 100755
--- a/src/meson.build
+++ b/src/meson.build
@@ -285,3 +285,23 @@ if get_option('nic').enabled()
         ],
     )
 endif
+
+if get_option('sol-pattern').enabled()
+    executable(
+        'solpatternsensor',
+        'PatternSensor.cpp',
+        'PatternSensorMain.cpp',
+        dependencies: [
+            i2c,
+            obmci2c,
+            sdbusplus,
+        ],
+        implicit_include_directories: false,
+        include_directories: '../include',
+        install: true,
+        link_with: [
+            thresholds_a,
+            utils_a,
+        ],
+    )
+endif
-- 
2.7.4

