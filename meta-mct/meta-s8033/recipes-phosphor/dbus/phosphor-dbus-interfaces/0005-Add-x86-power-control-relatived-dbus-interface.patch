From c19e01d3def4a6f26543ecf0fc457643bd2d24f2 Mon Sep 17 00:00:00 2001
From: "ray.lue" <ray.lue@mic.com.tw>
Date: Fri, 18 Jun 2021 22:11:33 +0800
Subject: [PATCH 1/1] Add-x86-power-control-relatived-dbus-interface

---
 .../openbmc_project/Common/ACBoot/meson.build | 13 +++++++++
 gen/xyz/openbmc_project/Common/meson.build    | 15 ++++++++++
 .../Control/Power/RestoreDelay/meson.build    | 14 +++++++++
 .../openbmc_project/Control/Power/meson.build | 15 ++++++++++
 .../Common/ACBoot.interface.yaml              |  8 +++++
 .../Control/Power/RestoreDelay.interface.yaml | 29 +++++++++++++++++++
 .../openbmc_project/State/Host.interface.yaml |  3 ++
 .../State/Watchdog.interface.yaml             | 27 +++++++++++++++++
 8 files changed, 124 insertions(+)
 create mode 100755 gen/xyz/openbmc_project/Common/ACBoot/meson.build
 mode change 100644 => 100755 gen/xyz/openbmc_project/Common/meson.build
 create mode 100755 gen/xyz/openbmc_project/Control/Power/RestoreDelay/meson.build
 mode change 100644 => 100755 gen/xyz/openbmc_project/Control/Power/meson.build
 create mode 100644 yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml
 create mode 100755 yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml
 mode change 100644 => 100755 yaml/xyz/openbmc_project/State/Host.interface.yaml
 mode change 100644 => 100755 yaml/xyz/openbmc_project/State/Watchdog.interface.yaml

diff --git a/gen/xyz/openbmc_project/Common/ACBoot/meson.build b/gen/xyz/openbmc_project/Common/ACBoot/meson.build
new file mode 100755
index 00000000..fa52e0b5
--- /dev/null
+++ b/gen/xyz/openbmc_project/Common/ACBoot/meson.build
@@ -0,0 +1,13 @@
+# Generated file; do not modify.
+generated_sources += custom_target(
+    'xyz/openbmc_project/Common/ACBoot__cpp'.underscorify(),
+    input: [ '../../../../../yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml',  ],
+    output: [ 'server.cpp', 'server.hpp', 'client.hpp',  ],
+    command: [
+        sdbuspp_gen_meson_prog, '--command', 'cpp',
+        '--output', meson.current_build_dir(),
+        '--tool', sdbusplusplus_prog,
+        '--directory', meson.current_source_dir() / '../../../../../yaml',
+        'xyz/openbmc_project/Common/ACBoot',
+    ],
+)
diff --git a/gen/xyz/openbmc_project/Common/meson.build b/gen/xyz/openbmc_project/Common/meson.build
old mode 100644
new mode 100755
index 39344cfd..00ba54b8
--- a/gen/xyz/openbmc_project/Common/meson.build
+++ b/gen/xyz/openbmc_project/Common/meson.build
@@ -138,3 +138,18 @@ generated_others += custom_target(
     ],
 )
 
+subdir('ACBoot')
+generated_others += custom_target(
+    'xyz/openbmc_project/Common/ACBoot__markdown'.underscorify(),
+    input: [ '../../../../yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml',  ],
+    output: [ 'ACBoot.md' ],
+    command: [
+        sdbuspp_gen_meson_prog, '--command', 'markdown',
+        '--output', meson.current_build_dir(),
+        '--tool', sdbusplusplus_prog,
+        '--directory', meson.current_source_dir() / '../../../../yaml',
+        'xyz/openbmc_project/Common/ACBoot',
+    ],
+)
+
+
diff --git a/gen/xyz/openbmc_project/Control/Power/RestoreDelay/meson.build b/gen/xyz/openbmc_project/Control/Power/RestoreDelay/meson.build
new file mode 100755
index 00000000..de7788e5
--- /dev/null
+++ b/gen/xyz/openbmc_project/Control/Power/RestoreDelay/meson.build
@@ -0,0 +1,14 @@
+# Generated file; do not modify.
+generated_sources += custom_target(
+    'xyz/openbmc_project/Control/Power/RestoreDelay__cpp'.underscorify(),
+    input: [ '../../../../../../yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml',  ],
+    output: [ 'server.cpp', 'server.hpp', 'client.hpp',  ],
+    command: [
+        sdbuspp_gen_meson_prog, '--command', 'cpp',
+        '--output', meson.current_build_dir(),
+        '--tool', sdbusplusplus_prog,
+        '--directory', meson.current_source_dir() / '../../../../../../yaml',
+        'xyz/openbmc_project/Control/Power/RestoreDelay',
+    ],
+)
+
diff --git a/gen/xyz/openbmc_project/Control/Power/meson.build b/gen/xyz/openbmc_project/Control/Power/meson.build
old mode 100644
new mode 100755
index dbd3b409..c65fa996
--- a/gen/xyz/openbmc_project/Control/Power/meson.build
+++ b/gen/xyz/openbmc_project/Control/Power/meson.build
@@ -55,3 +55,18 @@ generated_others += custom_target(
     ],
 )
 
+subdir('RestoreDelay')
+generated_others += custom_target(
+    'xyz/openbmc_project/Control/Power/RestoreDelay__markdown'.underscorify(),
+    input: [ '../../../../../yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml',  ],
+    output: [ 'RestoreDelay.md' ],
+    command: [
+        sdbuspp_gen_meson_prog, '--command', 'markdown',
+        '--output', meson.current_build_dir(),
+        '--tool', sdbusplusplus_prog,
+        '--directory', meson.current_source_dir() / '../../../../../yaml',
+        'xyz/openbmc_project/Control/Power/RestoreDelay',
+    ],
+)
+
+
diff --git a/yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml b/yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml
new file mode 100644
index 00000000..b28496f7
--- /dev/null
+++ b/yaml/xyz/openbmc_project/Common/ACBoot.interface.yaml
@@ -0,0 +1,8 @@
+description: >
+    Implement to provide system ACBoot flag
+properties:
+    - name: ACBoot
+      type: string
+      description: >
+          Flag for system ACBoot.
+
diff --git a/yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml b/yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml
new file mode 100755
index 00000000..66e59009
--- /dev/null
+++ b/yaml/xyz/openbmc_project/Control/Power/RestoreDelay.interface.yaml
@@ -0,0 +1,29 @@
+description: >
+    Implement to specify power transition behavior on a BMC reset.
+
+properties:
+    - name: PowerRestoreDelay
+      type: uint32
+      description: >
+          The delay for setting always-on.
+
+    - name: PowerRestoreAlwaysOnPolicy
+      type: enum[self.AlwaysOnPolicy]
+      description: >
+          The policy to adopt after the BMC reset and using always-on policy.
+
+enumerations:
+    - name: AlwaysOnPolicy
+      description: >
+        Possible power restoration always-on policies.
+      values:
+        - name: Immediately
+          description: >
+            Without delay time for bmc power on
+        - name: Random
+          description: >
+            Set a random delay time for bmc power on.
+        - name: Fixed
+          description: >
+            Set a fixed delay time for bmc power on.
+
diff --git a/yaml/xyz/openbmc_project/State/Host.interface.yaml b/yaml/xyz/openbmc_project/State/Host.interface.yaml
old mode 100644
new mode 100755
index ba0c5704..834f023e
--- a/yaml/xyz/openbmc_project/State/Host.interface.yaml
+++ b/yaml/xyz/openbmc_project/State/Host.interface.yaml
@@ -47,6 +47,9 @@ enumerations:
           description: >
             Host firmware will be rebooted without notification and chassis
             power will remain on throughout the reboot
+        - name: 'gracefulOff'
+          description: >
+            Host firmware should be soft off
 
     - name: HostState
       description: >
diff --git a/yaml/xyz/openbmc_project/State/Watchdog.interface.yaml b/yaml/xyz/openbmc_project/State/Watchdog.interface.yaml
old mode 100644
new mode 100755
index c5979793..531e5f1b
--- a/yaml/xyz/openbmc_project/State/Watchdog.interface.yaml
+++ b/yaml/xyz/openbmc_project/State/Watchdog.interface.yaml
@@ -33,6 +33,11 @@ properties:
       description: >
           The action the watchdog should perform when it expires.
       default: 'None'
+    - name: PreTimeoutInterrupt
+      type: enum[self.PreTimeoutInterruptAction]
+      description: >
+          The BMC generates the selected interrupt before the timer expires.
+      default: 'None'
     - name: Interval
       type: uint64
       description: >
@@ -54,6 +59,11 @@ properties:
       description: >
           The timer user at the time of expiration.
       default: 'Reserved'
+    - name: PreTimeoutInterruptOccurFlag
+      type: boolean
+      description: >
+          PreTimeoutInterruptOccurFlag that preTimeoutInterrupt action occurred.
+      default: false
 
 enumerations:
    - name: Action
@@ -73,6 +83,23 @@ enumerations:
          description: >
            Perform a power cycle of the system.
 
+   - name: PreTimeoutInterruptAction
+     description: >
+       The type of PreTimeout Interrupt.
+     values:
+       - name: 'None'
+         description: >
+           Do nothing.
+       - name: 'SMI'
+         description: >
+           SMI.
+       - name: 'NMI'
+         description: >
+           NMI / Diagnostic Interrupt.
+       - name: 'MI'
+         description: >
+           Messaging Interrupt.
+
    - name: TimerUse
      description: >
        The type of timer use.
-- 
2.29.0

