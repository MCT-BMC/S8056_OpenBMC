// SPDX-License-Identifier: GPL-2.0
// Copyright (c) 2017 Intel Corporation
/dts-v1/;

#include "aspeed-g5.dtsi"
#include <dt-bindings/gpio/aspeed-gpio.h>

/ {
    model = "s8033 BMC";
    compatible = "mct,s8033-bmc", "aspeed,ast2500";

    chosen {
        stdout-path = &uart5;
        bootargs = "earlyprintk";
    };

    memory {
        reg = <0x80000000 0x20000000>;
    };

    reserved-memory {
        #address-cells = <1>;
        #size-cells = <1>;
        ranges;

		gfx_memory: framebuffer@96000000 {
			no-map;
			compatible = "shared-dma-pool";
			reg = <0x96000000 0x02000000>; /* 32M */
        };

        flash_memory: region@98000000 {
            no-map;
            reg = <0x98000000 0x02000000>; /* 32M */
        };

		ramoops@9c000000 {
			compatible = "ramoops";
			reg = <0x9b000000 0x180000>; /* 16 * (3 * 0x8000) */
			record-size = <0x8000>;
			console-size = <0x8000>;
			pmsg-size = <0x8000>;
			max-reason = <3>; /* KMSG_DUMP_EMERG */
		};

		vga_memory: framebuffer@9f000000 {
			no-map;
			compatible = "shared-dma-pool";
			reg = <0x9c000000 0x01000000>; /* 64M */
        };

    };

    vga-shared-memory {
        compatible = "aspeed,ast2500-vga-sharedmem";
        reg = <0x9ff00000 0x100000>;
    };

    leds {
        compatible = "gpio-leds";

        identify {
            gpios = <&gpio ASPEED_GPIO(A, 2) GPIO_ACTIVE_LOW>;
        };

        hw-fault {
            gpios = <&gpio ASPEED_GPIO(F, 4) GPIO_ACTIVE_LOW>;
        };

        sys-fault {
            gpios = <&gpio ASPEED_GPIO(F, 5) GPIO_ACTIVE_LOW>;
        };
    };

    iio-hwmon {
        compatible = "iio-hwmon";
        io-channels = <&adc 0>, <&adc 1>, <&adc 2>, <&adc 3>,
            <&adc 4>, <&adc 5>, <&adc 6>, <&adc 7>,
            <&adc 8>, <&adc 9>, <&adc 10>, <&adc 11>,
            <&adc 12>, <&adc 13>, <&adc 14>, <&adc 15>;
    };
};

&fmc {
    status = "okay";
    flash@0 {
        status = "okay";
        m25p,fast-read;
        label = "bmc";
#include "openbmc-flash-layout-64.dtsi"
    };

    flash@1 {
        status = "okay";
        m25p,fast-read;
        label = "bmc2";

        partitions {
            compatible = "fixed-partitions";
            #address-cells = <1>;
            #size-cells = <1>;

            u-boot@0 {
                reg = <0x0 0xe0000>; // 896KB
                label = "bak-u-boot";
            };

            u-boot-env@e0000 {
                reg = <0xe0000 0x20000>; // 128KB
                label = "bak-u-boot-env";
            };

            kernel@100000 {
                reg = <0x100000 0x900000>; // 9MB
                label = "bak-kernel";
            };

            rofs@a00000 {
                reg = <0xa00000 0x2000000>; // 32MB
                label = "bak-rofs";
            };

            rwfs@2a00000 {
                reg = <0x2a00000 0x1600000>; // 22MB
                label = "bak-rwfs";
            };
        };
	};
};

&spi1 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_spi1_default>;

    flash@0 {
        status = "okay";
        m25p,fast-read;
        label = "pnor";
    };
};

&uart1 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_txd1_default
                 &pinctrl_rxd1_default
                 &pinctrl_ncts1_default
                 &pinctrl_ndcd1_default
                 &pinctrl_ndsr1_default
                 &pinctrl_nri1_default
                 &pinctrl_ndtr1_default
                 &pinctrl_nrts1_default>;
};

&uart2 {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_txd2_default
                 &pinctrl_rxd2_default>;
};

&uart3 {
    status = "okay";
};

&uart5 {
    status = "okay";
};

&mac1 {
    status = "okay";

    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_rgmii2_default>;
};

&i2c0 {
    status = "okay";
    cpu@4c {
        compatible = "amd,sbtsi";
        reg = <0x4c>;
    };
};

&i2c1 {
    status = "okay";
};

&i2c2 {
    status = "okay";
    eeprom@50 {
        compatible = "atmel,24c256";
        reg = <0x50>;
        pagesize = <32>;
    };
    gpio@70 {
        compatible = "nxp,pca9538";
        reg = <0x70>;
        gpio-controller;
        #gpio-cells = <2>;
        gpio-line-names = "FAN_PRESENT0", "FAN_PRESENT1",
                          "FAN_PRESENT2", "FAN_PRESENT3",
                          "FAN_PRESENT4", "FAN_PRESENT5",
                          "FAN_PRESENT6", "FAN_PRESENT7";
    };
};

&i2c3 {
    status = "okay";
    power-supply@58 {
        compatible = "pmbus";
        reg = <0x58>;
    };
    power-supply@59 {
        compatible = "pmbus";
        reg = <0x59>;
    };
    power-supply@60 {
        compatible = "MiTAC,mct-pdb";
        reg = <0x60>;
    };
    HotSwap@10 {
        compatible = "adm1272";
        reg = <0x10>;
    };
    eeprom@57 {
        compatible = "atmel,24c02";
        reg = <0x57>;
        pagesize = <8>;
    };
};

&i2c4 {
    status = "okay";
};

&i2c5 {
    status = "okay";
    nct7802@28 {
        compatible = "nuvoton,nct7802";
        reg = <0x28>;
    };
    eeprom@50 {
        compatible = "atmel,24c256";
        reg = <0x50>;
        pagesize = <32>;
    };
};

&i2c6 {
    status = "okay";
    i2c-switch@71 {
        compatible = "nxp,pca9548";
        #address-cells = <1>;
        #size-cells = <0>;
        reg = <0x71>;
        i2c-mux-idle-disconnect;

        mux1_ch0:i2c@0 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <0>;
        };

        mux1_ch1:i2c@1 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <1>;
        };

        mux1_ch2:i2c@2 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <2>;
        };

        mux1_ch3:i2c@3 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <3>;
        };

        mux1_ch4:i2c@4 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <4>;
        };

        mux1_ch5:i2c@5 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <5>;
        };

        mux1_ch6:i2c@6 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <6>;
        };

        mux1_ch7:i2c@7 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <7>;
        };
    };
    i2c-mux@72 {
        compatible = "nxp,pca9544";
        #address-cells = <1>;
        #size-cells = <0>;
        reg = <0x72>;
        i2c-mux-idle-disconnect;

        i2c@0 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <0>;
        };

        i2c@1 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <1>;
        };

        i2c@2 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <2>;
        };

        i2c@3 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <3>;
        };
    };
};

&i2c7 {
    status = "okay";
    multi-master;
};

&i2c8 {
    status = "okay";
    multi-master;

    bmc@10 {
        compatible = ",slave-mqueue";
        reg = <0x10>;
    };

    i2c-mux@77 {
        compatible = "nxp,pca9544";
        #address-cells = <1>;
        #size-cells = <0>;
        reg = <0x77>;

        i2c@0 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <0>;
            gpu@4f {
                compatible = "nvidai,a10";
                reg = <0x4f>;
            };
        };

        i2c@1 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <1>;
        };

        i2c@2 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <2>;

            eeprom@50 {
                compatible = "atmel,24c32";
                reg = <0x50>;
                pagesize = <32>;
            };
        };

        i2c@3 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <3>;
        };
    };
    
};

&gfx {
       status = "okay";
       memory-region = <&gfx_memory>;
};

&video {
       status = "okay";
       memory-region = <&gfx_memory>;
};

&vhub {
       status = "okay";
};

&pwm_tacho {
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm0_default &pinctrl_pwm1_default &pinctrl_pwm2_default &pinctrl_pwm3_default &pinctrl_pwm4_default &pinctrl_pwm5_default>;
    sysfan1@0 {
        reg = <0x00>;
        aspeed,fan-tach-ch = /bits/ 8 <0x00>;
    };

    sysfan2@1 {
        reg = <0x01>;
        aspeed,fan-tach-ch = /bits/ 8 <0x01>;
    };

    sysfan3@2 {
        reg = <0x02>;
        aspeed,fan-tach-ch = /bits/ 8 <0x02>;
    };

    sysfan4@3 {
        reg = <0x02>;
        aspeed,fan-tach-ch = /bits/ 8 <0x03>;
    };

    sysfan5@4 {
        reg = <0x03>;
        aspeed,fan-tach-ch = /bits/ 8 <0x04>;
    };

    sysfan6@5 {
        reg = <0x03>;
        aspeed,fan-tach-ch = /bits/ 8 <0x05>;
    };

    sysfan7@6 {
        reg = <0x04>;
        aspeed,fan-tach-ch = /bits/ 8 <0x06>;
    };

    sysfan8@7 {
        reg = <0x05>;
        aspeed,fan-tach-ch = /bits/ 8 <0x07>;
    };

    sysfan9@8 {
        reg = <0x00>;
        aspeed,fan-tach-ch = /bits/ 8 <0x08>;
    };

    sysfan10@9 {
        reg = <0x01>;
        aspeed,fan-tach-ch = /bits/ 8 <0x09>;
    };

    sysfan11@10 {
        reg = <0x02>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0A>;
    };

    sysfan12@11 {
        reg = <0x02>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0B>;
    };

    sysfan13@12 {
        reg = <0x03>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0C>;
    };

    sysfan14@13 {
        reg = <0x03>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0D>;
    };

    sysfan15@14 {
        reg = <0x04>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0E>;
    };

    sysfan16@15 {
        reg = <0x05>;
        aspeed,fan-tach-ch = /bits/ 8 <0x0F>;
    };
};

&lpc_ctrl {
    status = "okay";
    memory-region = <&flash_memory>;
    flash = <&spi1>;
};

&adc {
    status = "okay";
};

&kcs1 {
    status = "okay";
    aspeed,lpc-io-reg = <0xca0>;
};

&kcs2 {
    status = "okay";
    aspeed,lpc-io-reg = <0xca8>;
};

&kcs3 {
    status = "okay";
    aspeed,lpc-io-reg = <0xca2>;
};

&hbled {
    status = "okay";
};

&gpio {
    status = "okay";

    pinctrl-names = "pass-through";
    pinctrl-0 = <&pinctrl_gpie0_default
                 &pinctrl_gpie2_default>;

    gpio-line-names =
    /*A0-A7*/   "","","","SYS_AC_LOSS","","","","",
    /*B0-B7*/   "","","","","","","","",
    /*C0-C7*/   "","","","","","","","",
    /*D0-D7*/   "","","PS_PWROK","","","","","",
    /*E0-E7*/   "POWER_BUTTON","PWRBTN_OUT","RESET_BUTTON","RSTBTN_OUT","NMI_BUTTON","NMI_OUT","","",
    /*F0-F7*/   "","CLR_CMOS","BUTTON_LOCK","","","","","",
    /*G0-G7*/   "JTAG_MUX_S","JTAG_MUX_OE","HDT_SEL","JTAG_OE_N","","","JTAG_HDR_N_S","HDT_DBREQ",
    /*H0-H7*/   "CPU_VRHOT","SOC_VRHOT","","MEM_ABCD_VRHOT","MEM_EFGH_VRHOT","","PROCHOT","THERMTRIP",
    /*I0-I7*/   "","","","","","","","",
    /*J0-J7*/   "","","","BIOS_SLECT","","","","",
    /*K0-K7*/   "","","","","","","","",
    /*L0-L7*/   "","","","","","","","",
    /*M0-M7*/   "","","","","","","","",
    /*N0-N7*/   "","","","","","","","",
    /*O0-O7*/   "","","","","","","","",
    /*P0-P7*/   "","","","","","","","",
    /*Q0-Q7*/   "","","","","","","ID_BUTTON","",
    /*R0-R7*/   "","","","BAT_MON","","","","",
    /*S0-S7*/   "","","","","","","","",
    /*T0-T7*/   "","","","","","","","",
    /*U0-U7*/   "","","","","","","","",
    /*V0-V7*/   "","","","","","","","",
    /*W0-W7*/   "","","","","","","","",
    /*X0-X7*/   "","","","","","","","",
    /*Y0-Y7*/   "POST_START","POST_COMPLETE","","","","","","",
    /*Z0-Z7*/   "","PSU1_AC_LOSS","PSU2_AC_LOSS","","","","","",
    /*AA0-AA7*/ "","","","","","ASSERT_PROCHOT","","BMC_READY",
    /*AB0-AB7*/ "","","","","","","","",
    /*AC0-AC7*/ "","","","","","","","";
};

&lpc_snoop {
    status = "okay";
    snoop-ports = <0x80 0x81>;
    clocks = <&syscon ASPEED_CLK_GATE_LCLK>;
};

&jtag {
    status = "okay";
};

&rtc {
    status = "okay";
};

&lpc {
    interrupt {
        status = "okay";
        compatible = "aspeed,bmc-misc";
        interrupts-extended = <&scu_ic 5>;
        lpc-rst {
            offset = <0x08>;
            bit-mask = <1>;
            bit-shift = <6>;
        };
    };
};

&wdt2 {
	aspeed,alt-boot;
};